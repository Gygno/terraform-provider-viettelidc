// Copyright (c) HashiCorp, Inc.
// SPDX-License-Identifier: MPL-2.0

package voks

import (
	"fmt"
	"strconv"
	"testing"

	"github.com/hashicorp/terraform-plugin-testing/helper/resource"
)

func TestKubeconfigDatasource(t *testing.T) {

	var (
		clusterId = 2459
		value     = "apiVersion: v1\nclusters:\n- cluster:\n    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM2akNDQWRLZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJME1URXhOREE0TWpZMU9Wb1hEVE0wTVRFeE1qQTRNekUxT1Zvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTXBJCnVpVVgzd1VReU5STmQ3SEpGSkpOdnpxNE55WmlNSUxmNmtaT2REaEF5MEo5azRYN1BLVXpmejY5VngvNHBUTjcKUXIrcmx4Zk5UNkR5UGhOQkljS29NLzRoeUJUeFM4SG9BT0Q3ODZkdFJZaEZqcmdHbXpkUU85Y2x2YThuajN6cwo1OWg2MGJTZTBsY29mQkRTLzI4QWM5VzhSSnArODkvSmZOdjlTMENCUVZRcjZlK3B1WnhlMU51YTlSRllBanlTCnBqVWFodW90SGJhYnVkQUV6dkxxb3dGLzNCNG5EWHM2SElBNEp6b3grY05TYVdTNjcvME1JcWcvNlhhUzBlT2oKeGZHb05aVXlyUDVGTXF2a09TcGtOSzhtTzBEUXROMWpvVDNZVCtZTi9yRkRTNmJGa3pjMlVFNWFUc2FZbFk2NApCYTdnb3J3WVF0MlRhTXE3b0I4Q0F3RUFBYU5GTUVNd0RnWURWUjBQQVFIL0JBUURBZ0trTUJJR0ExVWRFd0VCCi93UUlNQVlCQWY4Q0FRQXdIUVlEVlIwT0JCWUVGSnVOQW1rOGZxd0d6Rk9SdFJQZm4wbG51RS82TUEwR0NTcUcKU0liM0RRRUJDd1VBQTRJQkFRQkFTZFNQQURvdVp6VDJkNEMyVjk3UERHMzY0d1I5cExQZUhXMEtpRTJhcWVCSgp0MTJsY3gvbHord1M2TEVHOUdRRVllY0ZtdEV6N2FNd1BpZm9LVUpTdGEwNmxFbnVoVWdVNjZtVWJ2VUQzdVErCkxheHBBUWlKZ0hrbnR5NHFCNVFzZCtlaWVtS0didmM4RkZmSk1RNDJ1VzNpQzZUczYzMWZIMXN4ZmVLTU1HRHoKdEI5cHJRY2xnRVVLYkN4dDdTWVJteVAxL3c0dm5lUkp3SDdIN1N0bnFIb21Kb1NYU2pzc0djRnpPeTNpcHBCRgpnb1N3K2cveld0blpXbXY2N0N5R1FqSy9teUJXLzFLNzdCOVowcW9FMkM1NjBWOVVTRCtTdk1DRHJXejN3MjNqCkNQZXBnd09rT3N4YnJ5Sllla0VCdzFWZ2ozbWg3bkllTU5sTDRVR1YKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\n    server: https://172.17.11.221:6443\n  name: k8s-idc-162e0ab7\ncontexts:\n- context:\n    cluster: k8s-idc-162e0ab7\n    user: k8s-idc-162e0ab7-admin\n  name: k8s-idc-162e0ab7-admin@k8s-idc-162e0ab7\ncurrent-context: k8s-idc-162e0ab7-admin@k8s-idc-162e0ab7\nkind: Config\npreferences: {}\nusers:\n- name: k8s-idc-162e0ab7-admin\n  user:\n    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURFekNDQWZ1Z0F3SUJBZ0lJWGQwaDRvQWY2Qjh3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TkRFeE1UUXdPREkyTlRsYUZ3MHlOVEV4TVRRd09ETXlNREJhTURReApGekFWQmdOVkJBb1REbk41YzNSbGJUcHRZWE4wWlhKek1Sa3dGd1lEVlFRREV4QnJkV0psY201bGRHVnpMV0ZrCmJXbHVNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQTBEU253Q09YbWk2Qkl4L24KM3hJMUxiWis0OG5YbVEzQU5CWmF6TXh3RHpzdmN0Mkg0SkRIZXRFRUVudTNyVUR0VE5QaEJBU0diYzlvV2VvdAp5Zm95WStTd0t2SVVtSWZyOXV5WWJUWEJpNnRJUVdTVGJscGtXRUk0bU95SUlVOVNjMmVlTUtlQzJCeE1LT1BRClcvN1RKZ3dueCtLWklndmZIZUcxbzlHOWRLOWhmT2tDTlNEUkJjNkF1bFNWZlZKQ2N2VWN5cEFzMitiejZGaXAKOUxnUCtZbzB6OUdvNUlONktjakZybDN2N3hreUxHOVlQdmZCUkptQlJ2ZFJDd1poOUxpeEFub3IwVkQyL2hiKwp0U2pPSmltL3BEMTduL2ZNN1V0ZTh3NEhoMXd5K2pvMFpYWGdmc0J5ZmJHYU9QUnozc2gxVURjNFdLWTYwUmdvCk5ueDdwd0lEQVFBQm8wZ3dSakFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUgKQXdJd0h3WURWUjBqQkJnd0ZvQVVtNDBDYVR4K3JBYk1VNUcxRTkrZlNXZTRUL293RFFZSktvWklodmNOQVFFTApCUUFEZ2dFQkFCOE12RHh6WlBVOHZNRTY3Mk5ubGhNcS84RTIxN0cwMVl3azg3ZDNtT0dUVzlOMWx5QlJBZStSCnRYZHhwd0FJTGxxa1hZdXNpZ2N5bEpxUDF4MXFtZC9PT2xmTzJJVW4xRFhnS3JIOXFqYlVleUhyTTI5S0xwWGgKeFRMNUFpNmVWdW41RGtEUDZxVlR1eVphUFJDVlJOdTdHMHBiZ2h3R1lzQzFRRVFuaWRzejlzNXlIV3A2VHBuRQp2ZC9FeFhrZlh6ZytGMnpSYVA1ZlNROG02TTQxQloxSVBuS3FPM3A1eDE5azJvL3hDWmVXSWtTQVF1TCtGMktDCnhmV2dSRGNZQmFBcnB6Qm84bnZNY3k2dW1SZWtMekJTZlRVZklJREg2RmdYbDQ3c01SdzI0REdNNkdhZU5qN0wKV0NsMmVFK3RiZTdaZWhJZzFZTFNJOEhIMDhrblJSdz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\n    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcFFJQkFBS0NBUUVBMERTbndDT1htaTZCSXgvbjN4STFMYlorNDhuWG1RM0FOQlphek14d0R6c3ZjdDJICjRKREhldEVFRW51M3JVRHRUTlBoQkFTR2JjOW9XZW90eWZveVkrU3dLdklVbUlmcjl1eVliVFhCaTZ0SVFXU1QKYmxwa1dFSTRtT3lJSVU5U2MyZWVNS2VDMkJ4TUtPUFFXLzdUSmd3bngrS1pJZ3ZmSGVHMW85RzlkSzloZk9rQwpOU0RSQmM2QXVsU1ZmVkpDY3ZVY3lwQXMyK2J6NkZpcDlMZ1ArWW8wejlHbzVJTjZLY2pGcmwzdjd4a3lMRzlZClB2ZkJSSm1CUnZkUkN3Wmg5TGl4QW5vcjBWRDIvaGIrdFNqT0ppbS9wRDE3bi9mTTdVdGU4dzRIaDF3eStqbzAKWlhYZ2ZzQnlmYkdhT1BSejNzaDFVRGM0V0tZNjBSZ29Obng3cHdJREFRQUJBb0lCQUZHQSsxWWMyTUR6aVh2dApob0J0aVVHKzJnZGp3VEZhRDY2VVBiRkVLbTNiOW1RWjBwSVhPdSthR09UL1oxUzhRT2k5WEsyTTgrN1NyWC9kClMxVnd5djhOeStUVDVUb2NvME9ETk53em1mT0o5bndhMmhmdDdMQWNKRG5CQmowNzV3UGtRU204dVZ6T0h3WTIKd0I3ekwwY0twUnY3V1lUWmJ0c3N1MFZJMnNodEZtYVJiS0pTM3VZWUIyVUorUWJxbHhxbm9CZnpqMytPelM2OAo2NXF1eCtFSTQrUVJKZnJyRUNyK2szck9wOVd5TUZqaDdjcWU3V3h3aDVQVEhobGNTRnI4QVVETC8xWDE4MEY4CkJvbDNYSmx0VEo4TnhPTm9DaUwzZXNGMFVqbS9zWDU5TTl6SlAxNVRtZnRBV3NrejMvVkMvb0VpZzVhNlBiOTUKUUkrWDZYRUNnWUVBOFdXaFpUVHczcnpTTUlvUG83OXpJYVpHOUNXbGRCZWs0bmlRT1R6WTNWZTlzVGRIUlUyQgo4blRsVjUxdVoyb0JQV2VrbU1QUjlaYUlNZXA5S0lQbnNaaGpRRU4rQkg2RG9ScXdBSEdEYTV1OVovYkg1Uk43CnhjbHRHaS9IMytHSERKZkFaUTVyNmtKWVlwdXJ4V3dzYzArNHQ5bUVrUDAxWlkrYmJNc05leDhDZ1lFQTNNMEMKMUR3TnVrdTE0VEpDNkhQbmdvbC9VbWloUHI5aXMxcDN2WUhhcEZidW1mK0haNnVobUdqK2Q1VDE3dUJna2RjdQpBZ3JrUVloNEIzWlFrWVI0eEtvVlJxRGxxUjF4b1Y4c2NGV1JqQUQxcGFMMVBwRG4zRnlvK2RNUE1qYmh2WTdkCkRaM0duWERrM3UzMnVTeDRGUkE4Qkc0T1pqNmlaRTBrWnNzRGRua0NnWUVBN1FvaEcrS0tqQTNhVURPaCsrZHAKUktla2tPWE92RnJqWEVlTFI4bEtJcitmMDc4MlN3VTdEenhlWUZTRkx5TldxRmQzdDFMQ2YyZ2J3UGhEZ2w5VQpTbjRiSitXZWZ3ZEVkaFJnczI3RDRBMEVSbXg4Q2FQQ0xJd0lpR2hXMnE3NUVCS0xxREFySTlPV091NG1GQ3lPCjBZUjlISHVKdzE0QTZ3UERXV2RpaTMwQ2dZRUF4L2c4S2E3QjJBa2RqZmlSTkNsVWNKcktYdjQzbXJhR1UxMEoKdU8zVDhLWnlyYklKRmRFUkp4RmY5VGxKaXJCWGhYM1dReTlPRGpQa1VRM01aaDROcWo5SHlaR0tyYURtK25sUgpxK016VUJMR1p0NnhNWnJYQW5KQTd4RkJYLzdvYjE3bHdLRTE4ZnorcXcvbE5VdWE3YWlvVW5MQ1E4TlNHM2pxCkVOYW9LakVDZ1lFQXlmWHhDZjQreUk0cGwxYlhrQlJGQWJPejZ0QWU4YzVYbnZFS3pGK04yL0FvSUJyYjNsOEEKMTVJNDNleTVyTHNIbXNkZXdIQXRWSlFKUDRTS0d3dVJQb3dDT0x1NFdNbXNDNStKMmxYN1cyWWxTTDR0L0hxKwptZUdlbm51Zzc5cHl4VXZObVh2V2d4ZU8vWjVOQmduWGEvc005VkdLSUtVZElxV2hrSUFkNzVFPQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=\n"
	)

	resource.Test(t, resource.TestCase{
		PreCheck:                 func() { testAccPreCheck(t) },
		ProtoV6ProviderFactories: testAccProtoV6ProviderFactories,
		Steps: []resource.TestStep{
			// Read testing
			{
				Config: providerConfig + testKubeconfigDataSourceConfig(clusterId),
				Check: resource.ComposeAggregateTestCheckFunc(
					resource.TestCheckResourceAttr("data.viettelidc_voks_kubeconfig.testing", "cluster_id", strconv.Itoa(clusterId)),
					resource.TestCheckResourceAttr("data.viettelidc_voks_kubeconfig.testing", "value", value),
				),
			},
		},
	})
}

func testKubeconfigDataSourceConfig(clusterId int) string {
	return fmt.Sprintf(`
data "viettelidc_voks_kubeconfig" "testing" {
    cluster_id = %d
}
`, clusterId)
}
